{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.default = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _dates = _interopRequireDefault(require(\"../../utils/dates\"));\n\nvar _selection = require(\"../../utils/selection\");\n\nvar _reactDom = require(\"react-dom\");\n\nvar _eventLevels = require(\"../../utils/eventLevels\");\n\nvar _Selection = _interopRequireWildcard(require(\"../../Selection\"));\n\nvar _EventRow = _interopRequireDefault(require(\"../../EventRow\"));\n\nvar _common = require(\"./common\");\n\nvar propTypes = process.env.NODE_ENV !== \"production\" ? {} : {};\n\nvar eventTimes = function eventTimes(event, accessors) {\n  var start = accessors.start(event);\n  var end = accessors.end(event);\n  var isZeroDuration = _dates.default.eq(start, end, 'minutes') && start.getMinutes() === 0; // make zero duration midnight events at least one day long\n\n  if (isZeroDuration) end = _dates.default.add(end, 1, 'day');\n  return {\n    start: start,\n    end: end\n  };\n};\n\nvar WeekWrapper = /*#__PURE__*/function (_React$Component) {\n  (0, _inheritsLoose2.default)(WeekWrapper, _React$Component);\n\n  function WeekWrapper() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _React$Component.call.apply(_React$Component, [this].concat(args)) || this;\n\n    _this.handleMove = function (_ref, node) {\n      var x = _ref.x,\n          y = _ref.y;\n      var event = _this.context.draggable.dragAndDropAction.event;\n      var metrics = _this.props.slotMetrics;\n      var accessors = _this.props.accessors;\n      if (!event) return;\n      var rowBox = (0, _Selection.getBoundsForNode)(node);\n\n      if (!(0, _selection.pointInBox)(rowBox, {\n        x: x,\n        y: y\n      })) {\n        _this.reset();\n\n        return;\n      } // Make sure to maintain the time of the start date while moving it to the new slot\n\n\n      var start = _dates.default.merge(metrics.getDateForSlot((0, _selection.getSlotAtX)(rowBox, x, false, metrics.slots)), accessors.start(event));\n\n      var end = _dates.default.add(start, _dates.default.diff(accessors.start(event), accessors.end(event), 'minutes'), 'minutes');\n\n      _this.update(event, start, end);\n    };\n\n    _this._selectable = function () {\n      var node = (0, _reactDom.findDOMNode)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this))).closest('.rbc-month-row, .rbc-allday-cell');\n      var container = node.closest('.rbc-month-view, .rbc-time-view');\n      var selector = _this._selector = new _Selection.default(function () {\n        return container;\n      });\n      selector.on('beforeSelect', function (point) {\n        var isAllDay = _this.props.isAllDay;\n        var action = _this.context.draggable.dragAndDropAction.action;\n        return action === 'move' || action === 'resize' && (!isAllDay || (0, _selection.pointInBox)((0, _Selection.getBoundsForNode)(node), point));\n      });\n      selector.on('selecting', function (box) {\n        var bounds = (0, _Selection.getBoundsForNode)(node);\n        var dragAndDropAction = _this.context.draggable.dragAndDropAction;\n        if (dragAndDropAction.action === 'move') _this.handleMove(box, bounds);\n        if (dragAndDropAction.action === 'resize') _this.handleResize(box, bounds);\n      });\n      selector.on('selectStart', function () {\n        return _this.context.draggable.onStart();\n      });\n      selector.on('select', function (point) {\n        var bounds = (0, _Selection.getBoundsForNode)(node);\n        if (!_this.state.segment || !(0, _selection.pointInBox)(bounds, point)) return;\n\n        _this.handleInteractionEnd();\n      });\n      selector.on('click', function () {\n        return _this.context.draggable.onEnd(null);\n      });\n    };\n\n    _this.handleInteractionEnd = function () {\n      var _this$props = _this.props,\n          resourceId = _this$props.resourceId,\n          isAllDay = _this$props.isAllDay;\n      var event = _this.state.segment.event;\n\n      _this.reset();\n\n      _this.context.draggable.onEnd({\n        start: event.start,\n        end: event.end,\n        resourceId: resourceId,\n        isAllDay: isAllDay\n      });\n    };\n\n    _this._teardownSelectable = function () {\n      if (!_this._selector) return;\n\n      _this._selector.teardown();\n\n      _this._selector = null;\n    };\n\n    _this.state = {};\n    return _this;\n  }\n\n  var _proto = WeekWrapper.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    this._selectable();\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    this._teardownSelectable();\n  };\n\n  _proto.reset = function reset() {\n    if (this.state.segment) this.setState({\n      segment: null\n    });\n  };\n\n  _proto.update = function update(event, start, end) {\n    var segment = (0, _eventLevels.eventSegments)((0, _extends2.default)({}, event, {\n      end: end,\n      start: start,\n      __isPreview: true\n    }), this.props.slotMetrics.range, _common.dragAccessors);\n    var lastSegment = this.state.segment;\n\n    if (lastSegment && segment.span === lastSegment.span && segment.left === lastSegment.left && segment.right === lastSegment.right) {\n      return;\n    }\n\n    this.setState({\n      segment: segment\n    });\n  };\n\n  _proto.handleResize = function handleResize(point, node) {\n    var _this$context$draggab = this.context.draggable.dragAndDropAction,\n        event = _this$context$draggab.event,\n        direction = _this$context$draggab.direction;\n    var _this$props2 = this.props,\n        accessors = _this$props2.accessors,\n        metrics = _this$props2.slotMetrics;\n\n    var _eventTimes = eventTimes(event, accessors),\n        start = _eventTimes.start,\n        end = _eventTimes.end;\n\n    var rowBox = (0, _Selection.getBoundsForNode)(node);\n    var cursorInRow = (0, _selection.pointInBox)(rowBox, point);\n\n    if (direction === 'RIGHT') {\n      if (cursorInRow) {\n        if (metrics.last < start) return this.reset(); // add min\n\n        end = _dates.default.add(metrics.getDateForSlot((0, _selection.getSlotAtX)(rowBox, point.x, false, metrics.slots)), 1, 'day');\n      } else if (_dates.default.inRange(start, metrics.first, metrics.last) || rowBox.bottom < point.y && +metrics.first > +start) {\n        end = _dates.default.add(metrics.last, 1, 'milliseconds');\n      } else {\n        this.setState({\n          segment: null\n        });\n        return;\n      }\n\n      end = _dates.default.max(end, _dates.default.add(start, 1, 'day'));\n    } else if (direction === 'LEFT') {\n      // inbetween Row\n      if (cursorInRow) {\n        if (metrics.first > end) return this.reset();\n        start = metrics.getDateForSlot((0, _selection.getSlotAtX)(rowBox, point.x, false, metrics.slots));\n      } else if (_dates.default.inRange(end, metrics.first, metrics.last) || rowBox.top > point.y && +metrics.last < +end) {\n        start = _dates.default.add(metrics.first, -1, 'milliseconds');\n      } else {\n        this.reset();\n        return;\n      }\n\n      start = _dates.default.min(_dates.default.add(end, -1, 'day'), start);\n    }\n\n    this.update(event, start, end);\n  };\n\n  _proto.render = function render() {\n    var _this$props3 = this.props,\n        children = _this$props3.children,\n        accessors = _this$props3.accessors;\n    var segment = this.state.segment;\n    return _react.default.createElement(\"div\", {\n      className: \"rbc-addons-dnd-row-body\"\n    }, children, segment && _react.default.createElement(_EventRow.default, (0, _extends2.default)({}, this.props, {\n      selected: null,\n      className: \"rbc-addons-dnd-drag-row\",\n      segments: [segment],\n      accessors: (0, _extends2.default)({}, accessors, _common.dragAccessors)\n    })));\n  };\n\n  return WeekWrapper;\n}(_react.default.Component);\n\nWeekWrapper.contextTypes = {\n  draggable: _propTypes.default.shape({\n    onStart: _propTypes.default.func,\n    onEnd: _propTypes.default.func,\n    dragAndDropAction: _propTypes.default.object,\n    onBeginAction: _propTypes.default.func\n  })\n};\nWeekWrapper.propTypes = process.env.NODE_ENV !== \"production\" ? {\n  isAllDay: _propTypes.default.bool,\n  slotMetrics: _propTypes.default.object.isRequired,\n  accessors: _propTypes.default.object.isRequired,\n  getters: _propTypes.default.object.isRequired,\n  components: _propTypes.default.object.isRequired,\n  resourceId: _propTypes.default.any\n} : {};\nWeekWrapper.propTypes = process.env.NODE_ENV !== \"production\" ? propTypes : {};\nvar _default = WeekWrapper;\nexports.default = _default;\nmodule.exports = exports[\"default\"];","map":{"version":3,"sources":["/Users/user/Downloads/myapp/node_modules/react-big-calendar/lib/addons/dragAndDrop/WeekWrapper.js"],"names":["_interopRequireWildcard","require","_interopRequireDefault","exports","__esModule","default","_extends2","_inheritsLoose2","_assertThisInitialized2","_propTypes","_react","_dates","_selection","_reactDom","_eventLevels","_Selection","_EventRow","_common","propTypes","process","env","NODE_ENV","eventTimes","event","accessors","start","end","isZeroDuration","eq","getMinutes","add","WeekWrapper","_React$Component","_this","_len","arguments","length","args","Array","_key","call","apply","concat","handleMove","_ref","node","x","y","context","draggable","dragAndDropAction","metrics","props","slotMetrics","rowBox","getBoundsForNode","pointInBox","reset","merge","getDateForSlot","getSlotAtX","slots","diff","update","_selectable","findDOMNode","closest","container","selector","_selector","on","point","isAllDay","action","box","bounds","handleResize","onStart","state","segment","handleInteractionEnd","onEnd","_this$props","resourceId","_teardownSelectable","teardown","_proto","prototype","componentDidMount","componentWillUnmount","setState","eventSegments","__isPreview","range","dragAccessors","lastSegment","span","left","right","_this$context$draggab","direction","_this$props2","_eventTimes","cursorInRow","last","inRange","first","bottom","max","top","min","render","_this$props3","children","createElement","className","selected","segments","Component","contextTypes","shape","func","object","onBeginAction","bool","isRequired","getters","components","any","_default","module"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.default = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _dates = _interopRequireDefault(require(\"../../utils/dates\"));\n\nvar _selection = require(\"../../utils/selection\");\n\nvar _reactDom = require(\"react-dom\");\n\nvar _eventLevels = require(\"../../utils/eventLevels\");\n\nvar _Selection = _interopRequireWildcard(require(\"../../Selection\"));\n\nvar _EventRow = _interopRequireDefault(require(\"../../EventRow\"));\n\nvar _common = require(\"./common\");\n\nvar propTypes = process.env.NODE_ENV !== \"production\" ? {} : {};\n\nvar eventTimes = function eventTimes(event, accessors) {\n  var start = accessors.start(event);\n  var end = accessors.end(event);\n  var isZeroDuration = _dates.default.eq(start, end, 'minutes') && start.getMinutes() === 0; // make zero duration midnight events at least one day long\n\n  if (isZeroDuration) end = _dates.default.add(end, 1, 'day');\n  return {\n    start: start,\n    end: end\n  };\n};\n\nvar WeekWrapper =\n/*#__PURE__*/\nfunction (_React$Component) {\n  (0, _inheritsLoose2.default)(WeekWrapper, _React$Component);\n\n  function WeekWrapper() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _React$Component.call.apply(_React$Component, [this].concat(args)) || this;\n\n    _this.handleMove = function (_ref, node) {\n      var x = _ref.x,\n          y = _ref.y;\n      var event = _this.context.draggable.dragAndDropAction.event;\n      var metrics = _this.props.slotMetrics;\n      var accessors = _this.props.accessors;\n      if (!event) return;\n      var rowBox = (0, _Selection.getBoundsForNode)(node);\n\n      if (!(0, _selection.pointInBox)(rowBox, {\n        x: x,\n        y: y\n      })) {\n        _this.reset();\n\n        return;\n      } // Make sure to maintain the time of the start date while moving it to the new slot\n\n\n      var start = _dates.default.merge(metrics.getDateForSlot((0, _selection.getSlotAtX)(rowBox, x, false, metrics.slots)), accessors.start(event));\n\n      var end = _dates.default.add(start, _dates.default.diff(accessors.start(event), accessors.end(event), 'minutes'), 'minutes');\n\n      _this.update(event, start, end);\n    };\n\n    _this._selectable = function () {\n      var node = (0, _reactDom.findDOMNode)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this))).closest('.rbc-month-row, .rbc-allday-cell');\n      var container = node.closest('.rbc-month-view, .rbc-time-view');\n      var selector = _this._selector = new _Selection.default(function () {\n        return container;\n      });\n      selector.on('beforeSelect', function (point) {\n        var isAllDay = _this.props.isAllDay;\n        var action = _this.context.draggable.dragAndDropAction.action;\n        return action === 'move' || action === 'resize' && (!isAllDay || (0, _selection.pointInBox)((0, _Selection.getBoundsForNode)(node), point));\n      });\n      selector.on('selecting', function (box) {\n        var bounds = (0, _Selection.getBoundsForNode)(node);\n        var dragAndDropAction = _this.context.draggable.dragAndDropAction;\n        if (dragAndDropAction.action === 'move') _this.handleMove(box, bounds);\n        if (dragAndDropAction.action === 'resize') _this.handleResize(box, bounds);\n      });\n      selector.on('selectStart', function () {\n        return _this.context.draggable.onStart();\n      });\n      selector.on('select', function (point) {\n        var bounds = (0, _Selection.getBoundsForNode)(node);\n        if (!_this.state.segment || !(0, _selection.pointInBox)(bounds, point)) return;\n\n        _this.handleInteractionEnd();\n      });\n      selector.on('click', function () {\n        return _this.context.draggable.onEnd(null);\n      });\n    };\n\n    _this.handleInteractionEnd = function () {\n      var _this$props = _this.props,\n          resourceId = _this$props.resourceId,\n          isAllDay = _this$props.isAllDay;\n      var event = _this.state.segment.event;\n\n      _this.reset();\n\n      _this.context.draggable.onEnd({\n        start: event.start,\n        end: event.end,\n        resourceId: resourceId,\n        isAllDay: isAllDay\n      });\n    };\n\n    _this._teardownSelectable = function () {\n      if (!_this._selector) return;\n\n      _this._selector.teardown();\n\n      _this._selector = null;\n    };\n\n    _this.state = {};\n    return _this;\n  }\n\n  var _proto = WeekWrapper.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    this._selectable();\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    this._teardownSelectable();\n  };\n\n  _proto.reset = function reset() {\n    if (this.state.segment) this.setState({\n      segment: null\n    });\n  };\n\n  _proto.update = function update(event, start, end) {\n    var segment = (0, _eventLevels.eventSegments)((0, _extends2.default)({}, event, {\n      end: end,\n      start: start,\n      __isPreview: true\n    }), this.props.slotMetrics.range, _common.dragAccessors);\n    var lastSegment = this.state.segment;\n\n    if (lastSegment && segment.span === lastSegment.span && segment.left === lastSegment.left && segment.right === lastSegment.right) {\n      return;\n    }\n\n    this.setState({\n      segment: segment\n    });\n  };\n\n  _proto.handleResize = function handleResize(point, node) {\n    var _this$context$draggab = this.context.draggable.dragAndDropAction,\n        event = _this$context$draggab.event,\n        direction = _this$context$draggab.direction;\n    var _this$props2 = this.props,\n        accessors = _this$props2.accessors,\n        metrics = _this$props2.slotMetrics;\n\n    var _eventTimes = eventTimes(event, accessors),\n        start = _eventTimes.start,\n        end = _eventTimes.end;\n\n    var rowBox = (0, _Selection.getBoundsForNode)(node);\n    var cursorInRow = (0, _selection.pointInBox)(rowBox, point);\n\n    if (direction === 'RIGHT') {\n      if (cursorInRow) {\n        if (metrics.last < start) return this.reset(); // add min\n\n        end = _dates.default.add(metrics.getDateForSlot((0, _selection.getSlotAtX)(rowBox, point.x, false, metrics.slots)), 1, 'day');\n      } else if (_dates.default.inRange(start, metrics.first, metrics.last) || rowBox.bottom < point.y && +metrics.first > +start) {\n        end = _dates.default.add(metrics.last, 1, 'milliseconds');\n      } else {\n        this.setState({\n          segment: null\n        });\n        return;\n      }\n\n      end = _dates.default.max(end, _dates.default.add(start, 1, 'day'));\n    } else if (direction === 'LEFT') {\n      // inbetween Row\n      if (cursorInRow) {\n        if (metrics.first > end) return this.reset();\n        start = metrics.getDateForSlot((0, _selection.getSlotAtX)(rowBox, point.x, false, metrics.slots));\n      } else if (_dates.default.inRange(end, metrics.first, metrics.last) || rowBox.top > point.y && +metrics.last < +end) {\n        start = _dates.default.add(metrics.first, -1, 'milliseconds');\n      } else {\n        this.reset();\n        return;\n      }\n\n      start = _dates.default.min(_dates.default.add(end, -1, 'day'), start);\n    }\n\n    this.update(event, start, end);\n  };\n\n  _proto.render = function render() {\n    var _this$props3 = this.props,\n        children = _this$props3.children,\n        accessors = _this$props3.accessors;\n    var segment = this.state.segment;\n    return _react.default.createElement(\"div\", {\n      className: \"rbc-addons-dnd-row-body\"\n    }, children, segment && _react.default.createElement(_EventRow.default, (0, _extends2.default)({}, this.props, {\n      selected: null,\n      className: \"rbc-addons-dnd-drag-row\",\n      segments: [segment],\n      accessors: (0, _extends2.default)({}, accessors, _common.dragAccessors)\n    })));\n  };\n\n  return WeekWrapper;\n}(_react.default.Component);\n\nWeekWrapper.contextTypes = {\n  draggable: _propTypes.default.shape({\n    onStart: _propTypes.default.func,\n    onEnd: _propTypes.default.func,\n    dragAndDropAction: _propTypes.default.object,\n    onBeginAction: _propTypes.default.func\n  })\n};\nWeekWrapper.propTypes = process.env.NODE_ENV !== \"production\" ? {\n  isAllDay: _propTypes.default.bool,\n  slotMetrics: _propTypes.default.object.isRequired,\n  accessors: _propTypes.default.object.isRequired,\n  getters: _propTypes.default.object.isRequired,\n  components: _propTypes.default.object.isRequired,\n  resourceId: _propTypes.default.any\n} : {};\nWeekWrapper.propTypes = process.env.NODE_ENV !== \"production\" ? propTypes : {};\nvar _default = WeekWrapper;\nexports.default = _default;\nmodule.exports = exports[\"default\"];"]},"metadata":{},"sourceType":"script"}